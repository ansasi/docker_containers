volumes:
  gluetun-data:
    driver: local

networks:
  proxy:
    external: true

services:
  # qBittorrent - Download Client
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent
    container_name: qbittorrent
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      UMASK: "002"
      TZ: "Etc/UTC"
      WEBUI_PORTS: "8085"
    # ports:
    #   - 8085:8085
    volumes:
      - /home/docker/docker_apps/arrs/qbittorrent/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads"
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

    # Jackett - Torrent and Usenet indexer
  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/jackett/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads" # optional
    # ports:
    #   - 8112:9117
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  # ###--- qBitmanage - qBittorrent manager - Used to run automated tasks for qBittorrent ---###
  # qbitmanage:
  #   image: ghcr.io/stuffanthings/qbit_manage:latest
  #   container_name: qbitmanage
  #   restart: unless-stopped
  #   environment:
  #     PUID: ${PUID}
  #     PGID: ${PGID}
  #     UMASK: 002
  #     TZ: Etc/UTC
  #     QBT_RUN: false
  #     QBT_SCHEDULE: 1440
  #     QBT_CONFIG: config.yml
  #     QBT_LOGFILE: activity.log
  #     QBT_CROSS_SEED: false
  #     QBT_RECHECK: false
  #     QBT_CAT_UPDATE: false
  #     QBT_TAG_UPDATE: false
  #     QBT_REM_UNREGISTERED: false
  #     QBT_REM_ORPHANED: false
  #     QBT_TAG_TRACKER_ERROR: false
  #     QBT_TAG_NOHARDLINKS: false
  #     QBT_SHARE_LIMITS: false
  #     QBT_SKIP_CLEANUP: false
  #     QBT_DRY_RUN: false
  #     QBT_LOG_LEVEL: INFO
  #     QBT_DIVIDER: =
  #     QBT_WIDTH: 100
  #   volumes:
  #     - ${MEDIA_ARRS_FOLDER:-/media}/torrents:/data/torrents
  #     - /home/docker/docker_apps/arrs/qbitmanage/config:/config
  #     - /home/docker/docker_apps/arrs/qbittorrent/data/BT_backup:/torrentdir
  #   network_mode: "service:gluetun"
  #   depends_on:
  #     - gluetun

  ###--- SABnzbd - Download client - Used to download NZB from Usenet groups ---###
  ### This container has been disabled since you need a premium Usenet provider subscription to download files. ###
  ### Enable this container if you found a free provider or want to pay for usenet ###
  # sabnzbd:
  #   image: lscr.io/linuxserver/sabnzbd:latest
  #   container_name: sabnzbd
  #   restart: unless-stopped
  #   environment:
  #     PUID: ${PUID}
  #     PGID: ${PGID}
  #     TZ: Etc/UTC
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #     - /home/docker/docker_apps/arrs/sabnzbd/config:/config
  #     - ${MEDIA_ARRS_FOLDER:-/media}/usenet:/data/usenet:rw
  #   ports:
  #     - 8085:8080
  #     - 9091:9090
  #   logging:
  #     driver: json-file
  #   network_mode: "service:gluetun"

  # Prowlarr - Indexer manager for all your media content
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/prowlarr/config:/config
    # ports:
    #   - "8113:9696"
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  ###--- Radarr - Library Manager for Movie content management ---###
  ### Do not use this container to download 4K Movie content. Enable container below to have seperate instance just for 4K Movie content ###
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/radarr/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/library/movies:/movies" # optional
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads" # optional
    # ports:
    #   - 8114:7878
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  ###--- Radarr 4K - Library Manager for Movie 4K content management ---###
  ### Enable this container to get seperate instance for 4K Movie content ###

  ###--- Sonarr - Library Manager for TV Show / Series / Anime content management ---###
  ### Do not use this container to download 4K TV content. Enable container below to have seperate instance just for 4K TV content ###
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/sonarr/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/library/tv:/tv"              # optional
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads"  # optional
    # ports:
    #   - 8115:8989
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  ###--- Sonarr 4K - Library Manager for TV 4K content management ---###
  ### Enable this container to get seperate instance for 4K TV content ###

  # Bazarr - Library Manager for Subtitle management
  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/bazarr/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/library/movies:/movies"  # optional
      - "${MEDIA_ARRS_FOLDER:-/media}/library/tv:/tv"          # optional
    # ports:
    #   - 8116:6767
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  # Lidarr - Library Manager for Music content management
  lidarr:
    image: lscr.io/linuxserver/lidarr:latest
    container_name: lidarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/lidarr/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/library/music:/music"       # optional
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads" # optional
    # ports:
    #   - 8117:8686
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

  # Readarr - Library Manager for Books / Epubs content management
  readarr:
    image: lscr.io/linuxserver/readarr:develop
    container_name: readarr
    restart: unless-stopped
    environment:
      PUID: "${PUID:-1000}"
      PGID: "${PGID:-1000}"
      TZ: "Etc/UTC"
    volumes:
      - /home/docker/docker_apps/arrs/readarr/config:/config
      - "${MEDIA_ARRS_FOLDER:-/media}/library/books:/books"      # optional
      - "${MEDIA_ARRS_FOLDER:-/media}/qbittorrent/downloads:/downloads" # optional
    # ports:
    #   - 8118:8787
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

#   ###--- Unpackerr - Extracts downloads for Radarr, Sonarr, Lidarr, and Readarr - Deletes extracted files after import. ---###
#   unpackerr:
#     image: lscr.io/linuxserver/unpackerr:latest
#     container_name: unpackerr
#     restart: unless-stopped
#     volumes:
#       - /home/docker/docker_apps/arrs/unpackerr/config:/config
#       - ${MEDIA_ARRS_FOLDER:-/media}/torrents:/data/torrents
#     environment:
#       PUID: ${PUID}
#       PGID: ${PGID}
#       TZ: Etc/UTC
#       UN_LOG_FILE: /data/torrents/unpackerr.log
#       UN_SONARR_0_URL: http://sonarr:8989/sonarr
#       UN_SONARR_0_API_KEY: IMPORT_SONARR_API_KEY_HERE
# #      UN_SONARR_1_URL: http://sonarr4k:8989/sonarr
# #      UN_SONARR_1_API_KEY: IMPORT_SONARR4k_API_KEY_HERE
#       UN_RADARR_0_URL: http://radarr:7878/radarr
#       UN_RADARR_0_API_KEY: IMPORT_RADARR_API_KEY_HERE
# #      UN_RADARR_1_URL: http://radarr4k:7878/radarr
# #      UN_RADARR_1_API_KEY: IMPORT_RADARR4k_API_KEY_HERE
#       UN_LIDARR_0_URL: http://lidarr:8686/lidarr
#       UN_LIDARR_0_API_KEY: IMPORT_LIDARR_API_KEY_HERE
#       UN_READARR_0_URL: http://readarr:8787/readarr
#       UN_READARR_0_API_KEY: IMPORT_READARR_API_KEY_HERE
#     security_opt:
#       - no-new-privileges:true
#     network_mode: "service:gluetun"
#     depends_on:
#       - gluetun

  # Gluetun - VPN Client - Used to connect to VPN services
  gluetun:
    image: qmcgaw/gluetun
    container_name: gluetun
    hostname: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - 6881:6881
      - 6881:6881/udp
      # Ports to apps:
      # - 8096:8096    # Jellyfin
      # - 5055:5055    # Jellyseerr
      # - 8085:8085    # qBittorrent
      # - 9696:9696    # Prowlarr
      # - 7878:7878    # Radarr
      # - 8989:8989    # Sonarr
      # - 6767:6767    # Bazarr
      # - 8686:8686    # Lidarr
      # - 8787:8787    # Readarr
      # - 9117:9117    # Jackett
    volumes:
      - gluetun-data:/gluetun
    environment:
      # VPN Configuration (see https://github.com/qdm12/gluetun-wiki for details)
      - VPN_SERVICE_PROVIDER=protonvpn
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_PRIVATE_KEY}
      - SERVER_COUNTRIES=Switzerland
      - STREAM_ONLY=on
      - TZ=Europe/Madrid
      - UPDATER_PERIOD=24h
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"

      # qBittorrent
      - traefik.http.routers.qbittorrent.entrypoints=web
      - traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.${DOMAIN}`)
      - traefik.http.routers.qbittorrent-websecure.entrypoints=websecure
      - traefik.http.routers.qbittorrent-websecure.rule=Host(`qbittorrent.${DOMAIN}`)
      - traefik.http.routers.qbittorrent-websecure.tls=true
      - traefik.http.routers.qbittorrent-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.qbittorrent-websecure.service=qbittorrent
      - traefik.http.services.qbittorrent.loadbalancer.server.port=8085

      # Prowlarr
      - traefik.http.routers.prowlarr.entrypoints=web
      - traefik.http.routers.prowlarr.rule=Host(`prowlarr.${DOMAIN}`)
      - traefik.http.routers.prowlarr-websecure.entrypoints=websecure
      - traefik.http.routers.prowlarr-websecure.rule=Host(`prowlarr.${DOMAIN}`)
      - traefik.http.routers.prowlarr-websecure.tls=true
      - traefik.http.routers.prowlarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.prowlarr-websecure.service=prowlarr
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696

      # Radarr
      - traefik.http.routers.radarr.entrypoints=web
      - traefik.http.routers.radarr.rule=Host(`radarr.${DOMAIN}`)
      - traefik.http.routers.radarr-websecure.entrypoints=websecure
      - traefik.http.routers.radarr-websecure.rule=Host(`radarr.${DOMAIN}`)
      - traefik.http.routers.radarr-websecure.tls=true
      - traefik.http.routers.radarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.radarr-websecure.service=radarr
      - traefik.http.services.radarr.loadbalancer.server.port=7878

      # Sonarr
      - traefik.http.routers.sonarr.entrypoints=web
      - traefik.http.routers.sonarr.rule=Host(`sonarr.${DOMAIN}`)
      - traefik.http.routers.sonarr-websecure.entrypoints=websecure
      - traefik.http.routers.sonarr-websecure.rule=Host(`sonarr.${DOMAIN}`)
      - traefik.http.routers.sonarr-websecure.tls=true
      - traefik.http.routers.sonarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.sonarr-websecure.service=sonarr
      - traefik.http.services.sonarr.loadbalancer.server.port=8989

      # Bazarr
      - traefik.http.routers.bazarr.entrypoints=web
      - traefik.http.routers.bazarr.rule=Host(`bazarr.${DOMAIN}`)
      - traefik.http.routers.bazarr-websecure.entrypoints=websecure
      - traefik.http.routers.bazarr-websecure.rule=Host(`bazarr.${DOMAIN}`)
      - traefik.http.routers.bazarr-websecure.tls=true
      - traefik.http.routers.bazarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.bazarr-websecure.service=bazarr
      - traefik.http.services.bazarr.loadbalancer.server.port=6767

      # Lidarr
      - traefik.http.routers.lidarr.entrypoints=web
      - traefik.http.routers.lidarr.rule=Host(`lidarr.${DOMAIN}`)
      - traefik.http.routers.lidarr-websecure.entrypoints=websecure
      - traefik.http.routers.lidarr-websecure.rule=Host(`lidarr.${DOMAIN}`)
      - traefik.http.routers.lidarr-websecure.tls=true
      - traefik.http.routers.lidarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.lidarr-websecure.service=lidarr
      - traefik.http.services.lidarr.loadbalancer.server.port=8686

      # Readarr
      - traefik.http.routers.readarr.entrypoints=web
      - traefik.http.routers.readarr.rule=Host(`readarr.${DOMAIN}`)
      - traefik.http.routers.readarr-websecure.entrypoints=websecure
      - traefik.http.routers.readarr-websecure.rule=Host(`readarr.${DOMAIN}`)
      - traefik.http.routers.readarr-websecure.tls=true
      - traefik.http.routers.readarr-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.readarr-websecure.service=readarr
      - traefik.http.services.readarr.loadbalancer.server.port=8787

      # Jackett
      - traefik.http.routers.jackett.entrypoints=web
      - traefik.http.routers.jackett.rule=Host(`jackett.${DOMAIN}`)
      - traefik.http.routers.jackett-websecure.entrypoints=websecure
      - traefik.http.routers.jackett-websecure.rule=Host(`jackett.${DOMAIN}`)
      - traefik.http.routers.jackett-websecure.tls=true
      - traefik.http.routers.jackett-websecure.tls.certresolver=cloudflare
      - traefik.http.routers.jackett-websecure.service=jackett
      - traefik.http.services.jackett.loadbalancer.server.port=9117
